---
title: "AWSã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆå›³ã‚’ä½œæˆã™ã‚‹"
emoji: "ğŸ“"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [aws, tech, cloudtech, èª²é¡Œ3]
published: false
---

## èª²é¡Œ

ãƒ»å®¢å…ˆã‹ã‚‰ä»¥ä¸‹ã®è¦æœ›ã‚’æº€ãŸã™ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆã®æå‡ºã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚ä¸‹è¨˜ã®è¦ä»¶ãŒã‚ã£ãŸæƒ³å®šã§AWSã‚’ä½¿ç”¨ã—ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ§‹æˆå›³ã‚’ä½œæˆã™ã‚‹ã€‚

## è¦ä»¶

- VPCã¯æœ¬ç•ªç’°å¢ƒç”¨ã«2ã¤ã€å…±é€šãƒ‡ãƒ¼ã‚¿é€£æºç”¨ã«1ã¤å¿…è¦
- 3ã¤ã®VPCã¯ãã‚Œãã‚Œç›¸äº’ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ãƒ«ãƒ¼ãƒˆãŒå¿…è¦
- å…±é€šãƒ‡ãƒ¼ã‚¿é€£æºç”¨VPCã¯è‡ªç¤¾ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã§å–ã‚Šæ‰±ã†ãƒ‡ãƒ¼ã‚¿ã¯é‡è¦æƒ…å ±ã®ãŸã‚ã€å°‚ç”¨ç·šã§è²»ç”¨å¯¾åŠ¹æœã®é«˜ã„è¨­è¨ˆãŒæœ›ã¾ã—ã„
- ä»Šå¾Œæ•°å¹´ã¯VPCãŒå¢—åŠ ã™ã‚‹å¯èƒ½æ€§ã¯ç„¡ã„

## è§£èª¬

### VPCã¯æœ¬ç•ªç’°å¢ƒç”¨ã«2ã¤ã€å…±é€šãƒ‡ãƒ¼ã‚¿é€£æºç”¨ã«1ã¤å¿…è¦

- åˆ©ç”¨æ¤œè¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼šVPC
- ä½œæˆã™ã‚‹VPCã®å€‹æ•°ï¼š3

### 3ã¤ã®VPCã¯ãã‚Œãã‚Œç›¸äº’ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ãƒ«ãƒ¼ãƒˆãŒå¿…è¦

- åˆ©ç”¨æ¤œè¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼š
  - VPCãƒ”ã‚¢ãƒªãƒ³ã‚°
  - Transit Gateway
- ç†ç”±ï¼šç•°ãªã‚‹VPCé–“ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’å¯èƒ½ã«ã™ã‚‹è¦ä»¶ã‚’æº€ãŸã™ãŸã‚

### å…±é€šãƒ‡ãƒ¼ã‚¿é€£æºç”¨VPCã¯è‡ªç¤¾ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹

- åˆ©ç”¨æ¤œè¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼š
  - AWS VPN
  - AWS Direct Connect
- ç†ç”±ï¼šè‡ªç¤¾ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨AWSã¨ã®é–“ã«å®‰å…¨ãªé€šä¿¡ã‚’ã™ã‚‹ãŸã‚

### ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã§å–ã‚Šæ‰±ã†ãƒ‡ãƒ¼ã‚¿ã¯é‡è¦æƒ…å ±ã®ãŸã‚ã€å°‚ç”¨ç·šã§è²»ç”¨å¯¾åŠ¹æœã®é«˜ã„è¨­è¨ˆãŒæœ›ã¾ã—ã„

- åˆ©ç”¨æ¤œè¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼šAWS Direct Connect
- ç†ç”±ï¼š
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è¦ä»¶ãŒé«˜ã„ãŸã‚

### ä»Šå¾Œæ•°å¹´ã¯VPCãŒå¢—åŠ ã™ã‚‹å¯èƒ½æ€§ã¯ç„¡ã„

- åˆ©ç”¨æ¤œè¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼šVPCãƒ”ã‚¢ãƒªãƒ³ã‚°
- ç†ç”±ï¼šæ•°å¹´ã§VPCãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒä½ã„ãŸã‚ã€ã¾ãŸVPCã®æ•°ãŒ3å€‹ã¨å°‘ãªã„ãŸã‚ç®¡ç†ãŒç…©é›‘ã«ãªã‚‹ãƒªã‚¹ã‚¯ãŒå°‘ãªã„ãŸã‚

## è¨­è¨ˆ

ä¸Šè¨˜ã®ç†ç”±ã‹ã‚‰ä¸‹è¨˜AWSãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆå›³ã‚’ä½œæˆã™ã‚‹

- VPN
- Internet Gateway
- VPCãƒ”ã‚¢ãƒªãƒ³ã‚°
- AWS Direct Connect

é€šä¿¡çµŒè·¯

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®é€šä¿¡ã¯Internet Gatewayã‚’é€šã‚ŠPublic Subnetã«æ¸¡ã‚‹
2. å…±é€šãƒ‡ãƒ¼ã‚¿é€£æºç”¨ã®VPCã¯Direct Connectã‚’é€šã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã¨é€šä¿¡ã™ã‚‹
3. å„VPCãŒç›¸äº’ã«é€šä¿¡ã™ã‚‹ãŸã‚ã«VPCãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’ï¼“ã¤ä½œæˆã™ã‚‹

## æ§‹æˆå›³ã®ä½œæˆ

pythonã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªdiagramsã‚’ä½¿ç”¨ã—ã¦ä½œæˆ

```python
from diagrams import Diagram, Cluster, Edge
from diagrams.aws.network import VPC, PrivateSubnet, PublicSubnet, DirectConnect, VPCPeering, InternetGateway
from diagrams.onprem.network import Internet
from diagrams.onprem.client import Users
from diagrams.onprem.compute import Server

graph_attr = {
    "fontsize": "20"
}

with Diagram("VPC Architecture Issue3", show=True, graph_attr=graph_attr, outformat="png"):
    users_01 = Users("ãƒ¦ãƒ¼ã‚¶ãƒ¼")
    datacenter = Server("ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼")
    direct_connect = DirectConnect("Direct Connect")

    with Cluster("AWS Cloud"):
        internet_gateway = InternetGateway("Internet Gateway")

        with Cluster("VPC for Production 1\n10.0.0.0/16"):
            vpc_prod_1 = VPC("VPC - Production 1")
            with Cluster("Subnets"):
                public_subnet_prod_1 = PublicSubnet("Public Subnet\n10.0.1.0/24")
                private_subnet_prod_1 = PrivateSubnet("Private Subnet\n10.0.2.0/24")

        with Cluster("VPC for Production 2\n10.1.0.0/16"):
            vpc_prod_2 = VPC("VPC - Production 2")
            with Cluster("Subnets"):
                public_subnet_prod_2 = PublicSubnet("Public Subnet\n10.1.1.0/24")
                private_subnet_prod_2 = PrivateSubnet("Private Subnet\n10.1.2.0/24")

        with Cluster("VPC for Data Integration\n10.2.0.0/16"):
            vpc_data_integration = VPC("VPC - Data Integration")
            with Cluster("Subnets"):
                public_subnet_data_integration = PublicSubnet("Public Subnet\n10.2.1.0/24")
                private_subnet_data_integration = PrivateSubnet("Private Subnet\n10.2.2.0/24")

        # Connect nodes within AWS Cloud
        vpc_peering_1 = VPCPeering("VPC Peering 1")
        vpc_peering_2 = VPCPeering("VPC Peering 2")
        vpc_peering_3 = VPCPeering("VPC Peering 3")

        vpc_prod_1 - Edge(color="brown", style="dashed") - vpc_peering_1 - Edge(color="brown", style="dashed") -  vpc_prod_2
        vpc_prod_1 - Edge(color="brown", style="dashed") - vpc_peering_2 - Edge(color="brown", style="dashed") -  vpc_data_integration
        vpc_prod_2 - Edge(color="brown", style="dashed") - vpc_peering_3 - Edge(color="brown", style="dashed") -  vpc_data_integration

    # Connect nodes outside of AWS Cloud
    users_01 - internet_gateway - public_subnet_prod_1
    users_01 - internet_gateway - public_subnet_prod_2
    datacenter - direct_connect - vpc_data_integration
```

## å®Ÿéš›ã®æ§‹æˆå›³

![æ§‹æˆå›³](https://storage.googleapis.com/zenn-user-upload/562edf8aef0d-20230625.png)

## å‚è€ƒè¨˜äº‹

- [ã€ä¿å­˜ç‰ˆã€‘AWS Direct Connectã¨ã¯ï¼Ÿæ¦‚è¦ã‚„VPNã¨ã®é•ã„ã€æ¥ç¶šã‚¿ã‚¤ãƒ—ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ï¼](https://atbex.attokyo.co.jp/blog/detail/9/)
